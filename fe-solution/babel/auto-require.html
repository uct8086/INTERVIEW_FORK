<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>如何用 Babel 为代码自动引入依赖 | 玩相机的程序员</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="代码和照片本质都是创造，是一种信息的传递。我是玩相机的程序员 axuebin，用键盘和相机记录和分享。">
    <link rel="preload" href="/articles/assets/css/0.styles.fe65aa1c.css" as="style"><link rel="preload" href="/articles/assets/js/app.3cef7185.js" as="script"><link rel="preload" href="/articles/assets/js/2.8d419c10.js" as="script"><link rel="preload" href="/articles/assets/js/15.d92386d7.js" as="script"><link rel="preload" href="/articles/assets/js/3.97f21fa0.js" as="script"><link rel="preload" href="/articles/assets/js/4.3f1e58e8.js" as="script"><link rel="prefetch" href="/articles/assets/js/10.9b4f5d4b.js"><link rel="prefetch" href="/articles/assets/js/11.1b1d54cb.js"><link rel="prefetch" href="/articles/assets/js/12.ff2d8f3d.js"><link rel="prefetch" href="/articles/assets/js/13.5319aa25.js"><link rel="prefetch" href="/articles/assets/js/14.a7790fa2.js"><link rel="prefetch" href="/articles/assets/js/16.3e0dde55.js"><link rel="prefetch" href="/articles/assets/js/17.b09396e6.js"><link rel="prefetch" href="/articles/assets/js/18.b9ce9c32.js"><link rel="prefetch" href="/articles/assets/js/19.311f2327.js"><link rel="prefetch" href="/articles/assets/js/20.ac770832.js"><link rel="prefetch" href="/articles/assets/js/5.1c310da4.js"><link rel="prefetch" href="/articles/assets/js/6.f64c5fbd.js"><link rel="prefetch" href="/articles/assets/js/7.0930e395.js"><link rel="prefetch" href="/articles/assets/js/8.0b9c45cf.js"><link rel="prefetch" href="/articles/assets/js/9.16d00e35.js">
    <link rel="stylesheet" href="/articles/assets/css/0.styles.fe65aa1c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/articles/" class="router-link-active home-link"><img src="/articles/assets/img/avatar.jpg" alt="玩相机的程序员" class="logo"> <span class="site-name">玩相机的程序员</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/articles/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/articles/fe-solution/" class="router-link-active">
          前端工程化
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/articles/fe-interview/">
          前端面试
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          关注我
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><div><div class="ads"><div id="ads_2"><div class="ant-carousel"><div class="slick-slider slick-initialized"><div class="slick-list"><div class="slick-track"><div tabIndex="-1" data-index="0" class="slick-slide slick-active slick-current" style="outline:none;width:null;"><div><div tabIndex="-1" style="width:100%;display:inline-block;"><a target="_blank" rel="noopener noreferrer"><img src="/articles/assets/img/qrcode2.jpg" title="Ads details here"></a></div></div></div></div></div></div></div></div></div> <div role="separator" id="reset-margin" class="ant-divider ant-divider-horizontal ant-divider-dashed"></div></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>脚手架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/fe-solution/cli/cra.html" title="create-react-app 核心思路分析" class="sidebar-link">create-react-app 核心思路分析</a></li><li><a href="/articles/fe-solution/cli/vuecli.html" title="Vue CLI 是如何实现的 -- 终端命令行工具篇" class="sidebar-link">Vue CLI 是如何实现的 -- 终端命令行工具篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Babel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/fe-solution/babel/first.html" title="初学 Babel 工作原理" class="sidebar-link">初学 Babel 工作原理</a></li><li><a href="/articles/fe-solution/babel/auto-require.html" aria-current="page" title="如何用 Babel 为代码自动引入依赖" class="active sidebar-link">如何用 Babel 为代码自动引入依赖</a></li><li><a href="/articles/fe-solution/babel/babel-plugin-import.html" title="简单实现 babel-plugin-import 插件" class="sidebar-link">简单实现 babel-plugin-import 插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>构建相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/fe-solution/build/rax-analysis.html" title="当我谈 Rax 按端拆分代码的时候我谈些什么" class="sidebar-link">当我谈 Rax 按端拆分代码的时候我谈些什么</a></li></ul></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="如何用-babel-为代码自动引入依赖"><a href="#如何用-babel-为代码自动引入依赖" class="header-anchor">#</a> 如何用 Babel 为代码自动引入依赖</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>最近在尝试玩一玩已经被大家玩腻的 <code>Babel</code>，今天给大家分享<strong>如何用 <code>Babel</code> 为代码自动引入依赖</strong>，通过一个简单的例子入门 <code>Babel</code> 插件开发。</p> <h2 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> b <span class="token keyword">from</span> <span class="token string">'b'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axuebin<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello babel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同学们都知道，如果运行上面的代码，一定是会报错的：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>VM105:2 Uncaught ReferenceError: axuebin is not defined
</code></pre></div><p>我们得首先通过 <code>import axuebin from 'axuebin'</code> 引入 <code>axuebin</code> 之后才能使用。。</p> <p>为了防止这种情况发生（一般来说我们都会手动引入），或者为你省去引入这个包的麻烦（其实有些编译器也会帮我们做了），我们可以在打包阶段分析每个代码文件，把这个事情做了。</p> <p>在这里，我们就基于最简单的场景做最简单的处理，在代码文件顶部加一句引用语句：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axuebin <span class="token keyword">from</span> <span class="token string">'axuebin'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axuebin<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello babel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="前置知识"><a href="#前置知识" class="header-anchor">#</a> 前置知识</h2> <h3 id="什么是-babel"><a href="#什么是-babel" class="header-anchor">#</a> 什么是 Babel</h3> <p>简单地说，<code>Babel</code> 能够转译 <code>ECMAScript 2015+</code> 的代码，使它在旧的浏览器或者环境中也能够运行。我们日常开发中，都会通过 <code>webpack</code> 使用 <code>babel-loader</code> 对 <code>JavaScript</code> 进行编译。</p> <h3 id="babel-是如何工作的"><a href="#babel-是如何工作的" class="header-anchor">#</a> Babel 是如何工作的</h3> <p>首先得要先了解一个概念：抽象语法树（Abstract Syntax Tree, AST），<code>Babel</code> 本质上就是在操作 <code>AST</code> 来完成代码的转译。</p> <p>了解了 <code>AST</code> 是什么样的，就可以开始研究 <code>Babel</code> 的工作过程了。</p> <p><code>Babel</code> 的功能其实很纯粹，它只是一个编译器。</p> <p>大多数编译器的工作过程可以分为三部分，如图所示：</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bed99ef139c74ffc88fd0a845429d7a5~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <ul><li><strong>Parse(解析)</strong> 将源代码转换成更加抽象的表示方法（例如抽象语法树）</li> <li><strong>Transform(转换)</strong> 对（抽象语法树）做一些特殊处理，让它符合编译器的期望</li> <li><strong>Generate(代码生成)</strong> 将第二步经过转换过的（抽象语法树）生成新的代码</li></ul> <p>所以我们如果想要修改 <code>Code</code>，就可以在 <code>Transform</code> 阶段做一些事情，也就是操作 <code>AST</code>。</p> <h3 id="ast-节点"><a href="#ast-节点" class="header-anchor">#</a> AST 节点</h3> <p>我们可以看到 <code>AST</code> 中有很多相似的元素，它们都有一个 <code>type</code> 属性，这样的元素被称作<strong>节点</strong>。一个节点通常含有若干属性，可以用于描述 <code>AST</code> 的部分信息。</p> <p>比如这是一个最常见的 <code>Identifier</code> 节点：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'Identifier'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'add'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以，操作 <code>AST</code> 也就是操作其中的节点，可以增删改这些节点，从而转换成实际需要的 <code>AST</code>。</p> <p>更多的节点规范可以查阅 <a href="https://github.com/estree/estree" target="_blank" rel="noopener noreferrer">https://github.com/estree/estree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="ast-遍历"><a href="#ast-遍历" class="header-anchor">#</a> AST 遍历</h3> <p><code>AST</code> 是深度优先遍历的，遍历规则不用我们自己写，我们可以通过特定的语法找到的指定的节点。</p> <p><code>Babel</code> 会维护一个称作 <code>Visitor</code> 的对象，这个对象定义了用于 <code>AST</code> 中获取具体节点的方法。</p> <p>一个 <code>Visitor</code> 一般是这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">ArrowFunction</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是箭头函数'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">IfStatement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是一个if语句'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>visitor</code> 上挂载以节点 <code>type</code> 命名的方法，当遍历 <code>AST</code> 的时候，如果匹配上 <code>type</code>，就会执行对应的方法。</p> <h2 id="操作-ast-的例子"><a href="#操作-ast-的例子" class="header-anchor">#</a> 操作 AST 的例子</h2> <p>通过上面简单的介绍，我们就可以开始任意造作了，肆意修改 <code>AST</code> 了。先来个简单的例子热热身。</p> <p>箭头函数是 <code>ES5</code> 不支持的语法，所以 <code>Babel</code> 得把它转换成普通函数，一层层遍历下去，找到了 <code>ArrowFunctionExpression</code> 节点，这时候就需要把它替换成 <code>FunctionDeclaration</code> 节点。所以，箭头函数可能是这样处理的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> <span class="token string">'@babel/types'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">ArrowFunction</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">FunctionDeclaration</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> params<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="开发-babel-插件的前置工作"><a href="#开发-babel-插件的前置工作" class="header-anchor">#</a> 开发 Babel 插件的前置工作</h2> <p>在开始写代码之前，我们还有一些事情要做一下：</p> <h3 id="分析-ast"><a href="#分析-ast" class="header-anchor">#</a> 分析 AST</h3> <p>将<strong>原代码</strong>和<strong>目标代码</strong>都解析成 <code>AST</code>，观察它们的特点，找找看如何<strong>增删改</strong> <code>AST</code> 节点，从而达到自己的目的。</p> <p>我们可以在 <a href="https://astexplorer.net" target="_blank" rel="noopener noreferrer">https://astexplorer.net<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上完成这个工作，比如文章最初提到的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> b <span class="token keyword">from</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axuebin<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello babel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>转换成 <code>AST</code> 之后是这样的：</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a98a04aa0ebb4a1c889b3ebdbfab1dd5~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>可以看出，这个 <code>body</code> 数组对应的就是根节点的三条语句，分别是：</p> <ul><li>VariableDeclaration: <code>const a = require('a')</code></li> <li>ImportDeclaration: <code>import b from 'b'</code></li> <li>ExpressionStatement: <code>console.log(axuebin.say('hello babel'))</code></li></ul> <p>我们可以打开 <code>VariableDeclaration</code> 节点看看：</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f8a2446389246c8a5d933e8cbe9dd31~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>它包含了一个 <code>declarations</code> 数组，里面有一个 <code>VariableDeclarator</code> 节点，这个节点有 <code>type</code>、<code>id</code>、<code>init</code> 等信息，其中 <code>id</code> 指的是表达式声明的变量名，<code>init</code> 指的是声明内容。</p> <p>通过这样查看/对比 <code>AST</code> 结构，就能分析出<strong>原代码</strong>和<strong>目标代码</strong>的特点，然后可以开始动手写程序了。</p> <h3 id="查看节点规范"><a href="#查看节点规范" class="header-anchor">#</a> 查看节点规范</h3> <p>节点规范：<a href="https://github.com/estree/estree" target="_blank" rel="noopener noreferrer">https://github.com/estree/estree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>我们要<strong>增删改</strong>节点，当然要知道节点的一些规范，比如新建一个 <code>ImportDeclaration</code> 需要传递哪些参数。</p> <h2 id="写代码"><a href="#写代码" class="header-anchor">#</a> 写代码</h2> <p>准备工作都做好了，那就开始吧。</p> <h3 id="初始化代码"><a href="#初始化代码" class="header-anchor">#</a> 初始化代码</h3> <p>我们的 <code>index.js</code> 代码为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">TARGET_PKG_NAME</span> <span class="token operator">=</span> <span class="token string">'axuebin'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    encoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transformSync</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    sourceMaps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      babel<span class="token punctuation">.</span><span class="token function">createConfigItem</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> types<span class="token operator">:</span> t <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        visitor<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们准备一个测试文件 <code>test.js</code>，代码为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test.js</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> b <span class="token keyword">from</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'d'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axuebin<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello babel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="分析-ast-编写对应-type-代码"><a href="#分析-ast-编写对应-type-代码" class="header-anchor">#</a> 分析 AST / 编写对应 type 代码</h3> <p>我们这次需要做的事情很简单，做两件事：</p> <ol><li>寻找当前 <code>AST</code> 中是否含有引用 <code>axuebin</code> 包的节点</li> <li>如果没引用，则修改 <code>AST</code>，插入一个 <code>ImportDeclaration</code> 节点</li></ol> <p>我们来分析一下 <code>test.js</code> 的 <code>AST</code>，看一下这几个节点有什么特征：</p> <h4 id="importdeclaration-节点"><a href="#importdeclaration-节点" class="header-anchor">#</a> ImportDeclaration 节点</h4> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4a19c2fd6304975be9d42131f6ec0e9~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p><code>ImportDeclaration</code> 节点的 <code>AST</code> 如图所示，我们需要关心的特征是 <code>value</code> 是否等于 <code>axuebin</code>，
代码这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">isImportDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isStringLiteral</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>node<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token constant">TARGET_PKG_NAME</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，可以通过 <code>path.get</code> 来获取对应节点的 <code>path</code>，嗯，比较规范。如果想获取对应的真实节点，还需要 <code>.node</code>。</p> <p>满足上述条件则可以认为当前代码已经引入了 <code>axuebin</code> 包，不用再做处理了。</p> <h4 id="variabledeclaration-节点"><a href="#variabledeclaration-节点" class="header-anchor">#</a> VariableDeclaration 节点</h4> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8aa6a62f2cc417a8233af9dbd0474cb~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>对于 <code>VariableDeclaration</code> 而言，我们需要关心的特征是，它是否是一个 <code>require</code> 语句，并且 <code>require</code> 的是 <code>axuebin</code>，代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 判断是否 require 了正确的包
 * @param {*} node 节点
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">isTrueRequire</span> <span class="token operator">=</span> <span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> callee<span class="token punctuation">,</span> arguments <span class="token punctuation">}</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'require'</span> <span class="token operator">&amp;&amp;</span>
    arguments<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token constant">TARGET_PKG_NAME</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">isVariableDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> declaration <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'declarations'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    declaration<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isCallExpression <span class="token operator">&amp;&amp;</span>
    <span class="token function">isTrueRequire</span><span class="token punctuation">(</span>declaration<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>node<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="expressionstatement-节点"><a href="#expressionstatement-节点" class="header-anchor">#</a> ExpressionStatement 节点</h4> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8296a0a3ed9f4d358a6d27b892790119~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p><code>require('c')</code>，语句我们一般不会用到，我们也来看一下吧，它对应的是 <code>ExpressionStatement</code> 节点，我们需要关心的特征和 <code>VariableDeclaration</code> 一致，这也是我把 <code>isTrueRequire</code> 抽出来的原因，所以代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">isExpressionStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">isTrueRequire</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'expression'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="插入引用语句"><a href="#插入引用语句" class="header-anchor">#</a> 插入引用语句</h3> <p>如果上述分析都没找到代码里引用了 <code>axuebin</code>，我们就需要手动插入一个引用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axuebin <span class="token keyword">from</span> <span class="token string">'axuebin'</span><span class="token punctuation">;</span>
</code></pre></div><p>通过 <code>AST</code> 分析，我们发现它是一个 <code>ImportDeclaration</code>：</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1057ea8f7d7c4aaeb05ca2bc37a96f71~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>简化一下就是这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ImportDeclaration&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;specifiers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ImportDefaultSpecifier&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;local&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;axuebin&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StringLiteral&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;axuebin&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，不是直接构建这个对象放进去就好了，需要通过 <code>babel</code> 的语法来构建这个节点（遵循规范）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> importDefaultSpecifier <span class="token operator">=</span> <span class="token punctuation">[</span>
  t<span class="token punctuation">.</span><span class="token function">ImportDefaultSpecifier</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token constant">TARGET_PKG_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> importDeclaration <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">ImportDeclaration</span><span class="token punctuation">(</span>
  importDefaultSpecifier<span class="token punctuation">,</span>
  t<span class="token punctuation">.</span><span class="token function">StringLiteral</span><span class="token punctuation">(</span><span class="token constant">TARGET_PKG_NAME</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>importDeclaration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样就插入了一个 <code>import</code> 语句。</p> <blockquote><p><code>Babel Types</code> 模块是一个用于 <code>AST</code> 节点的 <code>Lodash</code> 式工具库，它包含了构造、验证以及变换 <code>AST</code> 节点的方法。</p></blockquote> <h3 id="结果"><a href="#结果" class="header-anchor">#</a> 结果</h3> <p>我们 <code>node index.js</code> 一下，<code>test.js</code> 就变成：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axuebin <span class="token keyword">from</span> <span class="token string">'axuebin'</span><span class="token punctuation">;</span> <span class="token comment">// 已经自动加在代码最上边</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> b <span class="token keyword">from</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'d'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axuebin<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello babel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="彩蛋"><a href="#彩蛋" class="header-anchor">#</a> 彩蛋</h2> <p>如果我们还想帮他再多做一点事，还能做什么呢？</p> <p><strong>既然都自动引用了，那当然也要自动安装一下这个包呀！</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 判断是否安装了某个包
 * @param {string} pkg 包名
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasPkg</span> <span class="token operator">=</span> <span class="token parameter">pkg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pkgPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pkgJson <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span> <span class="token operator">?</span> fse<span class="token punctuation">.</span><span class="token function">readJsonSync</span><span class="token punctuation">(</span>pkgPath<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> dependencies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> devDependencies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> pkgJson<span class="token punctuation">;</span>
  <span class="token keyword">return</span> dependencies<span class="token punctuation">[</span>pkg<span class="token punctuation">]</span> <span class="token operator">||</span> devDependencies<span class="token punctuation">[</span>pkg<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 通过 npm 安装包
 * @param {string} pkg 包名
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">installPkg</span> <span class="token operator">=</span> <span class="token parameter">pkg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">开始安装 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> npm <span class="token operator">=</span> shell<span class="token punctuation">.</span><span class="token function">which</span><span class="token punctuation">(</span><span class="token string">'npm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>npm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请先安装 npm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> shell<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>npm<span class="token punctuation">.</span>stdout<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> install </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -S</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">安装 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 失败，请手动安装</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// biu~</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasPkg</span><span class="token punctuation">(</span><span class="token constant">TARGET_PKG_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">installPkg</span><span class="token punctuation">(</span><span class="token constant">TARGET_PKG_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>判断一个应用是否安装了某个依赖，有没有更好的办法呢？</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>我也是刚开始学 <code>Babel</code>，希望通过这个 <code>Babel</code> 插件的入门例子，可以让大家了解 <code>Babel</code> 其实并没有那么陌生，大家都可以玩起来 ~</p> <p>更多文章可以关注公众号「前端试炼」，分享每日前端精选文章。</p> <p>完整代码见：<a href="https://github.com/axuebin/babel-inject-dep-demo" target="_blank" rel="noopener noreferrer">https://github.com/axuebin/babel-inject-dep-demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/user-handbook.md" target="_blank" rel="noopener noreferrer">Babel 用户手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md" target="_blank" rel="noopener noreferrer">Babel 插件手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">ast 分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/estree/estree" target="_blank" rel="noopener noreferrer">节点规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="article-footer" data-v-4713b8bc><div role="separator" class="ant-divider ant-divider-horizontal" data-v-4713b8bc></div> <p data-v-4713b8bc>
    关注公众号
    <span class="bold" data-v-4713b8bc>玩相机的程序员</span></p> <p data-v-4713b8bc>原创文章持续更新中</p> <img src="/articles/assets/img/qrcode.jpg" data-v-4713b8bc> <p data-v-4713b8bc>我是 axuebin，用键盘和相机记录生活</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/articles/fe-solution/babel/first.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        初学 Babel 工作原理
      </a></span> <span class="next"><a href="/articles/fe-solution/babel/babel-plugin-import.html">
        简单实现 babel-plugin-import 插件
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><div class="right-group" data-v-63a47ae2><div class="item" data-v-63a47ae2><div class="title" data-v-63a47ae2>关注微信公众号</div> <div class="desc" data-v-63a47ae2>高质量原创文章</div> <img src="/articles/assets/img/qrcode.jpg" alt="玩相机的程序员" title="玩相机的程序员" data-v-63a47ae2></div> <div class="item" data-v-63a47ae2><div class="title" data-v-63a47ae2>加入前端划水群</div> <div class="desc" data-v-63a47ae2>
      扫码备注
      <span class="red" data-v-63a47ae2>加群</span></div> <img src="/articles/assets/img/wechat.jpg" alt="axuebin" title="axuebin" data-v-63a47ae2></div></div></div></div>
    <script src="/articles/assets/js/app.3cef7185.js" defer></script><script src="/articles/assets/js/2.8d419c10.js" defer></script><script src="/articles/assets/js/15.d92386d7.js" defer></script><script src="/articles/assets/js/3.97f21fa0.js" defer></script><script src="/articles/assets/js/4.3f1e58e8.js" defer></script>
  </body>
</html>